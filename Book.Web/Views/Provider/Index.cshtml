@{
    Layout = "/Views/Shared/_Layout.cshtml";
    List<Book.Model.T_Base_Provider> lst = ViewBag.lst;
    int count = ViewBag.count;
    int pageSize = ViewBag.PageSize;
    int MaxPageIndex = ViewBag.MaxPageIndex;
    String Name = ViewBag.Name;
}

@section css{

}
<section id="main-content">
    <section class="wrapper">
        <h3><i class="fa fa-angle-right"></i> 出版社信息</h3>
        <div class="row mt">
            <div class="col-lg-12">

                
                <div class="content-panel">
                    <!--查询框-->
                    <form class="form-inline" style="padding-left:50px" method="post" action="/provider/index">
                        <div class="form-group">
                            <label for="exampleInputName2">供应商名</label>
                            <input type="text" class="form-control" id="Name" name="Name" placeholder="" value=@Name>
                        </div>
 

                        <input type="submit" class="btn btn-default" value="查询"></input>
                    </form>
                    <h4><i class="fa fa-angle-right"></i>出版社列表 </h4>
                    <section id="unseen">
                        <table class="table table-bordered table-striped table-condensed">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>出版社名称</th>
                                    <th>电话</th>
                                    <th>传真</th>
                                    <th>备注</th>

                                </tr>
                            </thead>
                            <tbody id="bodyContent">
                                @foreach (var item in lst)
                                {
                                    <tr id="tr_@item.Id">
                                        <td>@item.Id</td>
                                        <td>@item.Name</td>
                                        <td>@item.Tel</td>
                                        <td>@item.Fax</td>
                                        <td>@item.Memo</td>


                                        <td>
                                            <a href="javascript:deleteJudge(@item.Id)">删除</a>
                                            <a href="/provider/update?id=@item.Id">编辑</a>
                                        </td>

                                    </tr>
                                }
                            </tbody>
                        </table>


                        <div class="btn-group" id="pageBtnGroup">
                            @{
                                for (int i = 1; i <= Math.Ceiling(count * 1.0 / pageSize); i++)
                                {
                                    if (i == 1)
                                    {
                                        <button type="button" class="btn btn-default active" onclick="getList(@i)">@i</button>
                                    }
                                    else
                                    {  <button type="button" class="btn btn-default" onclick="getList(@i)">@i</button>
                                    }
                                    if (i >= MaxPageIndex)
                                    {
                                        <button type="button" class="btn btn-default" onclick="getList(@(i+1))">...</button>
                                        <button type="button" class="btn btn-default" onclick="getList(@(Math.Ceiling(count * 1.0 / pageSize)))">@(Math.Ceiling(count * 1.0 / pageSize))</button>
                                        break;
                                    }
                                }
                            }

                        </div>

                    </section>
                </div><!-- /content-panel -->
            </div><!-- /col-lg-4 -->
        </div><!-- /row -->

    </section>



</section>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                请确认是否删除
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="bookDelete()">确定</button>
            </div>
        </div>
    </div>
</div>

@section js{
    <script type="text/javascript">
        currentId = 0;
        function deleteJudge(Id) {
            currentId = Id;
            $('#myModal').modal('show')
        }

        function bookDelete() {

            $('#myModal').modal('hide')
            Id = currentId;


            $.ajax({
                url: "/provider/DeleteJson",
                data: "Id=" + Id,
                type: "post",
                dataType: "json",
                success: function (result) {
                    $("#tr_" + Id).remove();
                },
                error: function () {
                    alert("通讯错误");
                }
            })

        }
    </script>
}

<script type="text/javascript">
    function getList(currentPage) {

        var name = $("#Name").val();
        $.ajax({
            url: "/provider/GetList",
            data: {currentPage:currentPage,Name:name},//"currentPage=" + currentPage,
            type: "post",
            success: function (result) {
                // alert(result[0].BookName);
                var html = "";
                for (var i = 0; i < result.length; i++) {
                    html += "<tr id=\"tr_" + result[i].Id + "\">";
                    html += " <td>" + result[i].Id + "</td>"
                    html += "<td>" + result[i].Name + "</td>";
                    html += "<td>" + result[i].Tel + "</td>";
                    html += "<td>" + result[i].Fax + "</td>";
                    html += "<td>" + result[i].Memo + "</td>";

                    html += "<td>";
                    html += "  <a href=\"javascript:bookDeletePre(" + result[i].Id + ")\">删除</a>";
                    html += "  <a href=\"/provider/update?Id=" + result[i].Id + ")\">编辑</a>";
                    html += "</td>";
                }
                //$("#bodyContent").html(html);
                document.getElementById("bodyContent").innerHTML = html;

                var btnGroupHtml = "";
                var j = 1;
                var PageIndex = (currentPage - 3 > 1 ? currentPage - 3 : 1);

                var tempMaxPageIndex = parseInt("@MaxPageIndex");
                var temp2 = parseInt("@Math.Ceiling(count * 1.0 / pageSize)");

                if (PageIndex != 1) {
                    btnGroupHtml += "<button type=\"button\" class=\"btn btn-default \" onclick=\"getList(" + 1 + ")\">" + 1 + "</button>";
                    btnGroupHtml += "<button type=\"button\" class=\"btn btn-default \" onclick=\"getList(" + (PageIndex - 1) + ")\">" + "..." + "</button>";

                }
                while (j <= (tempMaxPageIndex) && PageIndex <= temp2) {
                    if (PageIndex == currentPage) {
                        btnGroupHtml += "<button type=\"button\" class=\"btn btn-default active \" onclick=\"getList(" + PageIndex + ")\">" + PageIndex + "</button>";
                    }
                    else {
                        btnGroupHtml += "<button type=\"button\" class=\"btn btn-default \" onclick=\"getList(" + PageIndex + ")\">" + PageIndex + "</button>";
                    }
                    PageIndex++;
                    j++;
                }
                if (PageIndex - 1 != temp2) {
                    btnGroupHtml += "<button type=\"button\" class=\"btn btn-default \" onclick=\"getList(" + (PageIndex) + ")\">" + "..." + "</button>";
                    btnGroupHtml += "<button type=\"button\" class=\"btn btn-default \" onclick=\"getList(" + temp2 + ")\">" + temp2 + "</button>";
                }
                //$("#bodyContent").html(html);
                //document.getElementById("bodyContent").innerHTML = html;
                document.getElementById("pageBtnGroup").innerHTML = btnGroupHtml;
            },
            erroe: function () { }
        });
    }

</script>
